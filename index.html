<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom YouTube Player </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- CSS Styles --- */
        body {
            font-family: sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .youtube-player-container {
            position: relative;
            width: 90%;
            max-width: 640px;
            aspect-ratio: 16 / 9;
            margin: 20px auto;
            overflow: hidden;
            border: 3px solid #333;
            background-color: #111;
            color: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #youtube-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        #player-loading-message {
             font-size: 1.2em;
        }

        /* --- Custom Controls --- */
        .custom-player-button {
            position: absolute;
            bottom: 4px;
            right: 160px; /* Position adjusted */
            z-index: 10;
            background-color: rgba(40, 40, 40, 0.8);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease;
            pointer-events: auto;
        }

        .custom-player-button:hover {
            background-color: rgba(70, 70, 70, 0.9);
        }

        .custom-player-panel {
            position: absolute;
            bottom: 50px;
            right: 130px; /* Position adjusted */
            z-index: 11;
            background-color: rgba(30, 30, 30, 0.95);
            color: white;
            border-radius: 4px;
            min-width: 180px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            padding: 0;
            display: none;
            font-family: 'Roboto', sans-serif;
        }

        .custom-player-panel.visible {
            display: block;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            font-weight: 500;
        }

        .close-button {
            background: none;
            border: none;
            color: #aaa;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            padding: 0 5px;
        }
        .close-button:hover {
            color: white;
        }

        .language-list {
            list-style: none;
            margin: 0;
            padding: 5px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .language-list li button {
            display: block;
            width: 100%;
            background: none;
            border: none;
            color: #eee;
            padding: 10px 15px;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }

        .language-list li button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .language-list li button.active {
            background-color: rgba(80, 80, 80, 0.9);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>YouTube Players</h1>

    <div class="youtube-player-container">
        <div id="player-loading-message">Loading player...</div>
        <iframe id="youtube-player"
                src=""
                allowfullscreen
                allow="autoplay; encrypted-media">
        </iframe>

        <button id="custom-settings-btn" class="custom-player-button" title="Audio Tracks & Captions">
            <i class="fas fa-cog"></i> Audio
        </button>

        <div id="custom-settings-panel" class="custom-player-panel">
            <div class="panel-header">
                <span>Audio Track</span>
                <button id="close-settings-btn" class="close-button" title="Close">×</button>
            </div>
            <ul class="language-list">
                <li><button data-lang="en">English (Default)</button></li>
                <li><button data-lang="ru">Русский (Russian)</button></li>
                <li><button data-lang="fr">Français (French)</button></li>
                <li><button data-lang="pa">ਪੰਜਾਬੀ (Punjabi)</button></li>
                <li><button data-lang="pt">Português (Portuguese)</button></li>
                <li><button data-lang="es">Español (Spanish)</button></li>
                <li><button data-lang="ja">日本語 (Japanese)</button></li>
            </ul>
        </div>
    </div>

    <script>
        let player;
        let initialVideoId = 'M7lc1UVf-VE'; // IMPORTANT: Your Default English Video ID
        let shouldAutoplayNextVideo = true; // Autoplay subsequent videos by default

        // IMPORTANT: Update this map with your actual video IDs
        const languageVideoMap = {
            "en": "SVIpEdgH0PQ",  // English (Default)
            "ru": "haiftWsn5KY",  // Russian
            "fr": "1ytsF4dedyU",  // French
            "pa": "RoV6WAq9-rE",  // Punjabi
            "pt": "zUVLlQlnI1c",  // Portuguese
            "es": "Z8aBOAMAFew",  // Spanish (Example, replace)
            "ja": "Ybg90bQf3Xw",  // Japanese
        };

        function onYouTubeIframeAPIReady() {
            console.log("YouTube Iframe API Ready.");
            const loadingMessage = document.getElementById('player-loading-message');
            player = new YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                videoId: initialVideoId,
                playerVars: {
                    'playsinline': 1,
                    'autoplay': 1,             // Autoplay initial video
                    'controls': 1,
                    'rel': 0,
                    'modestbranding': 1,
                    'cc_load_policy': 1,       // Default captions to ON
                    'cc_lang_pref': 'en'       // Prefer English captions initially
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
            if (loadingMessage) loadingMessage.style.display = 'none';
        }

        function onPlayerReady(event) {
            console.log("Player Ready. Video ID:", player.getVideoData().video_id);
            // Autoplay is set in playerVars, but ensure play if browser policies allow
            // event.target.playVideo(); // This might be redundant due to autoplay:1 but can be a fallback
            
            // Attempt to set English captions for the initially loaded video
            setCaptionsForLanguage('en');
            updateActiveLanguageButton("en");
            setupCustomControls();
        }

        function onPlayerStateChange(event) {
            console.log("Player State Change:", event.data);
            if (event.data === YT.PlayerState.CUED && shouldAutoplayNextVideo) {
                console.log("Video cued and shouldAutoplayNextVideo is true. Playing video.");
                event.target.playVideo();
                // shouldAutoplayNextVideo = false; // Keep true if all subsequent loads should also autoplay
            } else if (event.data === YT.PlayerState.PLAYING) {
                console.log("Player is PLAYING.");
                const currentVideoId = player.getVideoData().video_id;
                let activeLang = "en"; // Default to English
                for (const lang in languageVideoMap) {
                    if (languageVideoMap[lang] === currentVideoId) {
                        activeLang = lang;
                        break;
                    }
                }
                updateActiveLanguageButton(activeLang);
                // When a video starts playing (either initial or subsequent), ensure captions for its language are set.
                // setCaptionsForLanguage(activeLang); // This might be too aggressive or re-apply unnecessarily.
                                                    // Caption setting is handled on load and on button click.
            }
        }

        function onPlayerError(event) {
            console.error("Player Error:", event.data);
            const loadingMessage = document.getElementById('player-loading-message');
            if (loadingMessage) {
                 loadingMessage.textContent = `Player Error: ${event.data}. Check video ID & permissions.`;
                 loadingMessage.style.display = 'block';
            }
        }

        function setCaptionsForLanguage(langCode) {
            if (!player || typeof player.loadModule !== 'function' || typeof player.setOption !== 'function') {
                console.error("Player not ready for setting captions.");
                return;
            }
            if (langCode) {
                player.loadModule('captions');
                setTimeout(() => { // Timeout helps ensure module is ready
                    try {
                        player.setOption('captions', 'track', {'languageCode': langCode});
                        console.log(`Attempting to set captions to: ${langCode}`);
                    } catch (e) {
                        console.error(`Error setting caption track for ${langCode}:`, e);
                    }
                }, 500);
            } else {
                // Logic to turn captions off if langCode is empty (e.g., for a "Captions Off" button)
                // For now, all our buttons have a langCode.
                // unloadModule might hide button, so be careful. player.setOption('captions', 'track', {}); might be better.
                 console.log("No language code provided for captions, captions might use video default or be off.");
            }
        }

        function setupCustomControls() {
          console.log("Setting up custom controls...");
          const settingsBtn = document.getElementById('custom-settings-btn');
          const settingsPanel = document.getElementById('custom-settings-panel');
          const closePanelBtn = document.getElementById('close-settings-btn');
          const langButtons = document.querySelectorAll('.language-list button');

          if (!settingsBtn || !settingsPanel || !closePanelBtn || !langButtons || !langButtons.length) {
             console.error("setupCustomControls: One or more control elements not found!"); return;
          }

          settingsBtn.addEventListener('click', () => {
            settingsPanel.classList.toggle('visible');
          });

          closePanelBtn.addEventListener('click', () => {
              settingsPanel.classList.remove('visible');
          });

          langButtons.forEach(button => {
            button.addEventListener('click', () => {
              const langCode = button.getAttribute('data-lang');
              console.log("Language button clicked. Selected code:", langCode);

              if (!player || typeof player.loadVideoById !== 'function') {
                  console.error("Player object or loadVideoById method not available.");
                  settingsPanel.classList.remove('visible'); return;
              }

              let videoIdToLoad = initialVideoId; // Default to English video

              if (langCode) {
                  if (languageVideoMap.hasOwnProperty(langCode)) {
                      const mappedVideoId = languageVideoMap[langCode];
                      // Generic placeholder check
                      if (mappedVideoId && typeof mappedVideoId === 'string' && !mappedVideoId.startsWith("YOUR_") && !mappedVideoId.endsWith("_ID_HERE")) {
                          videoIdToLoad = mappedVideoId;
                          console.log(`Found specific video for '${langCode}': ${videoIdToLoad}`);
                      } else {
                          console.warn(`Placeholder or invalid video ID for language '${langCode}'. Loading default English video: ${initialVideoId}`);
                      }
                  } else {
                      console.warn(`Language code '${langCode}' not found in map. Loading default English video: ${initialVideoId}`);
                  }
              }
              
              shouldAutoplayNextVideo = true; // Ensure subsequent videos attempt to autoplay

              console.log(`Calling player.loadVideoById('${videoIdToLoad}')`);
              player.loadVideoById(videoIdToLoad); // Autoplay handled by onStateChange or autoplay playerVar
              
              setCaptionsForLanguage(langCode); // Set captions for the newly selected language

              settingsPanel.classList.remove('visible');
            });
          });

          document.addEventListener('click', (event) => {
            if (settingsPanel.classList.contains('visible') && !settingsPanel.contains(event.target) && !settingsBtn.contains(event.target)) {
                settingsPanel.classList.remove('visible');
            }
          });
          console.log("Custom controls setup complete.");
        }

        function updateActiveLanguageButton(activeLangCode) {
            const langButtons = document.querySelectorAll('.language-list button');
            langButtons.forEach(button => {
                button.classList.remove('active');
                if (button.getAttribute('data-lang') === activeLangCode) {
                    button.classList.add('active');
                }
            });
        }

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api"; // Standard URL for YouTube API
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>

</body>
</html>
