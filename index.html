<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom YouTube Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- CSS Styles --- */
        body {
            font-family: sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .youtube-player-container {
            position: relative;
            width: 90%;
            max-width: 640px;
            aspect-ratio: 16 / 9;
            margin: 20px auto;
            overflow: hidden;
            border: 3px solid #333;
            background-color: #111; /* This is the black background you might be seeing */
            color: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #youtube-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        #player-loading-message {
             font-size: 1.2em;
        }

        /* --- Custom Controls --- */
        .custom-player-button {
            position: absolute;
            bottom: 4px;
            right: 160px; /* Position adjusted */
            z-index: 10;
            background-color: rgba(40, 40, 40, 0.8);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease;
            pointer-events: auto;
        }

        .custom-player-button:hover {
            background-color: rgba(70, 70, 70, 0.9);
        }

        .custom-player-panel {
            position: absolute;
            bottom: 50px;
            right: 130px; /* Position adjusted */
            z-index: 11;
            background-color: rgba(30, 30, 30, 0.95);
            color: white;
            border-radius: 4px;
            min-width: 180px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            padding: 0;
            display: none;
            font-family: 'Roboto', sans-serif;
        }

        .custom-player-panel.visible {
            display: block;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            font-weight: 500;
        }

        .close-button {
            background: none;
            border: none;
            color: #aaa;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            padding: 0 5px;
        }
        .close-button:hover {
            color: white;
        }

        .language-list {
            list-style: none;
            margin: 0;
            padding: 5px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .language-list li button {
            display: block;
            width: 100%;
            background: none;
            border: none;
            color: #eee;
            padding: 10px 15px;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }

        .language-list li button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .language-list li button.active {
            background-color: rgba(80, 80, 80, 0.9);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>YouTube Players</h1>

    <div class="youtube-player-container">
        <div id="player-loading-message">Loading player...</div>
        <iframe id="youtube-player"
                src="" allowfullscreen
                allow="autoplay; encrypted-media">
        </iframe>

        <button id="custom-settings-btn" class="custom-player-button" title="Audio Tracks & Captions">
            <i class="fas fa-cog"></i> Audio
        </button>

        <div id="custom-settings-panel" class="custom-player-panel">
            <div class="panel-header">
                <span>Audio Track</span>
                <button id="close-settings-btn" class="close-button" title="Close">×</button>
            </div>
            <ul class="language-list">
                <li><button data-lang="en">English (Default)</button></li>
                <li><button data-lang="ru">Русский (Russian)</button></li>
                <li><button data-lang="fr">Français (French)</button></li>
                <li><button data-lang="pa">ਪੰਜਾਬੀ (Punjabi)</button></li>
                <li><button data-lang="pt">Português (Portuguese)</button></li>
                <li><button data-lang="es">Español (Spanish)</button></li>
                <li><button data-lang="ja">日本語 (Japanese)</button></li>
            </ul>
        </div>
    </div>

    <script>
        let player;
        // IMPORTANT: Update this map with your actual video IDs.
        // Ensure these video IDs are public and allow embedding.
        const languageVideoMap = {
            "en": "SVIpEdgH0PQ",  // English (Default) - Make sure this ID is valid & embeddable
            "ru": "haiftWsn5KY",  // Russian - Make sure this ID is valid & embeddable
            "fr": "1ytsF4dedyU",  // French - Make sure this ID is valid & embeddable
            "pa": "RoV6WAq9-rE",  // Punjabi - Make sure this ID is valid & embeddable
            "pt": "zUVLlQlnI1c",  // Portuguese - Make sure this ID is valid & embeddable
            "es": "Z8aBOAMAFew",  // Spanish - Make sure this ID is valid & embeddable
            "ja": "Ybg90bQf3Xw",  // Japanese - Make sure this ID is valid & embeddable
        };

        // *** ADJUSTMENT: Ensure initialVideoId matches your intended default English video from the map ***
        let initialVideoId = languageVideoMap["en"]; // Uses "SVIpEdgH0PQ" from above
        let shouldAutoplayNextVideo = true; // Autoplay subsequent videos by default

        function onYouTubeIframeAPIReady() {
            console.log("YouTube Iframe API Ready. Initializing player with video ID:", initialVideoId);
            const loadingMessage = document.getElementById('player-loading-message');
            player = new YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                videoId: initialVideoId, // This will now be "SVIpEdgH0PQ" (or whatever is in languageVideoMap["en"])
                playerVars: {
                    'playsinline': 1,
                    'autoplay': 1,             // Autoplay initial video
                    'controls': 1,
                    'rel': 0,
                    'modestbranding': 1,
                    'cc_load_policy': 1,       // Default captions to ON
                    'cc_lang_pref': 'en'       // Prefer English captions initially
                    // If issues persist, try simplifying playerVars for testing:
                    // 'controls': 1 // (and comment out other playerVars)
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError // Crucial for debugging
                }
            });
            if (loadingMessage) loadingMessage.style.display = 'none';
        }

        function onPlayerReady(event) {
            console.log("Player Ready. Video ID from player data:", player.getVideoData().video_id);
            // Autoplay is set in playerVars. Browser policies might still affect it.
            // event.target.playVideo(); // Might be redundant but can be a fallback if autoplay:1 doesn't work as expected.
            
            setCaptionsForLanguage('en'); // Attempt to set English captions for the initially loaded video
            updateActiveLanguageButton("en");
            setupCustomControls();
        }

        function onPlayerStateChange(event) {
            console.log("Player State Change:", event.data, "Video ID:", player.getVideoData().video_id);
            // YT.PlayerState.ENDED (0), YT.PlayerState.PLAYING (1), YT.PlayerState.PAUSED (2), 
            // YT.PlayerState.BUFFERING (3), YT.PlayerState.CUED (5)

            if (event.data === YT.PlayerState.CUED && shouldAutoplayNextVideo) {
                console.log("Video cued and shouldAutoplayNextVideo is true. Playing video.");
                event.target.playVideo();
            } else if (event.data === YT.PlayerState.PLAYING) {
                console.log("Player is PLAYING.");
                const currentVideoId = player.getVideoData().video_id;
                let activeLang = "en"; // Default to English if no specific match found
                for (const lang in languageVideoMap) {
                    if (languageVideoMap[lang] === currentVideoId) {
                        activeLang = lang;
                        break;
                    }
                }
                updateActiveLanguageButton(activeLang);
            }
        }

        function onPlayerError(event) {
            // This function is VERY IMPORTANT for debugging the black screen.
            // Check your browser console for messages from here.
            console.error("Player Error Occurred. Error Code:", event.data);
            console.error("Video ID that caused error:", player.getVideoData().video_id || initialVideoId); // Log the ID
            const loadingMessage = document.getElementById('player-loading-message');
            if (loadingMessage) {
                 loadingMessage.textContent = `Player Error: ${event.data}. Check console & video ID/permissions.`;
                 loadingMessage.style.display = 'block';
            }
            // Common Error Codes:
            // 2: Invalid parameter (e.g., bad video ID format)
            // 5: HTML5 player error
            // 100: Video not found or private
            // 101, 150: Embedding disabled by video owner
        }

        function setCaptionsForLanguage(langCode) {
            if (!player || typeof player.loadModule !== 'function' || typeof player.setOption !== 'function') {
                console.warn("Player not fully ready or available for setting captions. Lang:", langCode);
                return;
            }
            if (langCode) {
                console.log("Attempting to load captions module for lang:", langCode);
                player.loadModule('captions'); // Loads the captions module
                setTimeout(() => { // Timeout helps ensure module is ready after loading
                    try {
                        console.log("Setting caption track to:", langCode);
                        player.setOption('captions', 'track', {'languageCode': langCode});
                    } catch (e) {
                        console.error(`Error setting caption track for ${langCode}:`, e);
                    }
                }, 500); // Adjust delay if needed
            } else {
                 console.log("No language code provided for captions; using video default or off.");
            }
        }

        function setupCustomControls() {
          console.log("Setting up custom controls...");
          const settingsBtn = document.getElementById('custom-settings-btn');
          const settingsPanel = document.getElementById('custom-settings-panel');
          const closePanelBtn = document.getElementById('close-settings-btn');
          const langButtons = document.querySelectorAll('.language-list button');

          if (!settingsBtn || !settingsPanel || !closePanelBtn || !langButtons || !langButtons.length) {
             console.error("setupCustomControls: Crucial control elements not found! Language selectors won't work."); return;
          }

          settingsBtn.addEventListener('click', () => {
            console.log("Audio settings button clicked.");
            settingsPanel.classList.toggle('visible');
          });

          closePanelBtn.addEventListener('click', () => {
              console.log("Close settings panel button clicked.");
              settingsPanel.classList.remove('visible');
          });

          langButtons.forEach(button => {
            button.addEventListener('click', () => {
              const langCode = button.getAttribute('data-lang');
              console.log("Language button clicked. Selected language code:", langCode);

              if (!player || typeof player.loadVideoById !== 'function') {
                  console.error("Player object or loadVideoById method not available when changing language.");
                  settingsPanel.classList.remove('visible'); return;
              }

              let videoIdToLoad = languageVideoMap["en"]; // Default to English video if something goes wrong

              if (langCode) {
                  if (languageVideoMap.hasOwnProperty(langCode)) {
                      const mappedVideoId = languageVideoMap[langCode];
                      // Basic check if it's not one of the generic placeholder patterns
                      if (mappedVideoId && typeof mappedVideoId === 'string' && !mappedVideoId.startsWith("YOUR_") && !mappedVideoId.endsWith("_ID_HERE")) {
                          videoIdToLoad = mappedVideoId;
                          console.log(`Found specific video for '${langCode}': ${videoIdToLoad}`);
                      } else {
                          console.warn(`Placeholder or invalid video ID in map for language '${langCode}'. Loading default English video: ${languageVideoMap["en"]}`);
                          videoIdToLoad = languageVideoMap["en"]; // Fallback to default English
                      }
                  } else {
                      console.warn(`Language code '${langCode}' not found in languageVideoMap. Loading default English video: ${languageVideoMap["en"]}`);
                      videoIdToLoad = languageVideoMap["en"]; // Fallback to default English
                  }
              } else {
                  console.warn("No langCode on button. Loading default English video:", languageVideoMap["en"]);
                  videoIdToLoad = languageVideoMap["en"]; // Fallback for safety
              }
              
              shouldAutoplayNextVideo = true; 

              console.log(`Calling player.loadVideoById with ID: '${videoIdToLoad}'`);
              player.loadVideoById(videoIdToLoad); 
              
              setCaptionsForLanguage(langCode); 

              settingsPanel.classList.remove('visible');
            });
          });

          document.addEventListener('click', (event) => {
            if (settingsPanel.classList.contains('visible') && !settingsPanel.contains(event.target) && !settingsBtn.contains(event.target)) {
                console.log("Clicked outside settings panel/button. Closing panel.");
                settingsPanel.classList.remove('visible');
            }
          });
          console.log("Custom controls setup complete.");
        }

        function updateActiveLanguageButton(activeLangCode) {
            const langButtons = document.querySelectorAll('.language-list button');
            langButtons.forEach(button => {
                button.classList.remove('active');
                if (button.getAttribute('data-lang') === activeLangCode) {
                    button.classList.add('active');
                }
            });
        }

        // Load the YouTube IFrame Player API code asynchronously.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api"; // Standard URL for YouTube API
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>

</body>
</html>
